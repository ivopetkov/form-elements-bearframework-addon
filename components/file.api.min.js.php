<?php

/*
 * Form elements addon for Bear Framework
 * https://github.com/ivopetkov/form-elements-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
for(var elements=document.body.querySelectorAll("[data-form-element-type='file']"),i=0;i<elements.length;i++)!function(e){if(void 0===e.dataFormElementAPISet){e.dataFormElementAPISet=!0;var t=e.querySelector("[data-form-element-component='clear-button']"),n=e.querySelector("[data-form-element-component='text']"),i=e.querySelector("input");i.getFormElementContainer=function(){return e};var r=[],l=function(e){for(var t=0;t<r.length;t++){var n=r[t];if(n[0]===e)return n[1]}return null};e.getValue=function(){var e=i.files,t=e.length;if(0===t)return i.getAttribute("data-value");for(var n=[],r=0;r<t;r++){var a=e[r],o=l(a);null!==o?n.push(o):n.push({value:a.name,filename:null,size:a.size,type:a.type})}return JSON.stringify(n)},e.setValue=function(e){if(""!==e)throw new Error("Only empty string allowed!");i.value="",i.setAttribute("data-value",""),i.dispatchEvent(new Event("change"))},e.hasPendingUploads=function(){for(var e=i.files,t=e.length,n=0;n<t;n++){if(!l(e[n]))return!0}return!1},e.upload=function(e,t,n,a,o){for(var u=i.files,f=u.length,s=0,c=[],v=0;v<f;v++){var d=u[v];null===l(d)?(c[v]=0,s++):c[v]=100}var m=function(i){if(void 0!==u[i]){var v=u[i];null===l(v)&&e(v,(function(e){m(i+1),s--,r.push([v,e]),0===s&&t()}),(function(){void 0!==n&&n()}),(function(){void 0!==a&&a()}),(function(e){c[i]=e,function(){if(void 0!==o){for(var e=0,t=0;t<f;t++)e+=c[t];o(e/f)}}()}))}};m(0)},e.setVisibility=function(t){e.setAttribute("data-form-element-visibility",t?"1":"0")},t.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),e.setValue("")}),!1);i.addEventListener("change",(function(){var r=i.files.length;if(0===r)n.innerText=0===e.getValue().length?"CHOOSE_TEXT_TO_REPLACE":"",t.style.display="none";else{if(1===r)var l=i.files[0].name;else l="SELECTED_FILES_COUNT_TEXT_TO_REPLACE".replace("%s",r);n.innerText=l,t.style.display="inline-block"}}),!1)}}(elements[i]);
EOT;
