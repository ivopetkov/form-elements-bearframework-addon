<?php

/*
 * Form elements addon for Bear Framework
 * https://github.com/ivopetkov/form-elements-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
for(var elements=document.body.querySelectorAll("[data-form-element-type='datetime']"),i=0;i<elements.length;i++)!function(e){if(void 0===e.dataFormElementAPISet){e.dataFormElementAPISet=!0;var t=e.querySelector("input"),n=e.querySelector('[data-form-element-component="button"]'),o=e.querySelector('[data-form-element-component="picker"]'),a=null!==n,r=null!==o,i=(t.getAttribute("showTime"),"false"!==t.getAttribute("showYear")),l="false"!==t.getAttribute("showClear"),u=-1!==["true",""].indexOf(t.getAttribute("multiple")),m="false"!==t.getAttribute("allowSelect"),d=ivoPetkovBearFrameworkAddonsFormElementsDateTimeFormatDate;a&&n.addEventListener("keydown",(function(e){13===e.keyCode&&n.click()}));var c=function(e){var t=[];if(null!=e)for(var n=e.split(";"),o=0;o<n.length;o++){var a=n[o].trim();a.length>0&&t.push(a)}return t},f=function(){var e=c(t.value);e.sort().reverse();var n=e.length>0?e[0]:"";i||(n=n.replace("0000-","2024-"));var o=""!==n?new Date(n):new Date;return i||o.setFullYear(2024),o},s=f(),v=e=>{s.setMonth(s.getMonth()+e),i||s.setFullYear(2024),k()},p=function(e,t){return(t?e.getFullYear().toString():"0000")+"-"+(e.getMonth()+1).toString().padStart(2,"0")+"-"+e.getDate().toString().padStart(2,"0")},h=function(e){t.value!==e&&(t.value=e,t.dispatchEvent(new Event("change",{bubbles:!0})),a&&A(),k())},g=null,b=function(e,t){void 0===t&&(t=null),clientPackages.get("tooltip").then((function(n){null===g&&(g=n.generateID()),e(n,g+(null!==t?"$"+t:""))}))};if(a){var y=document.createElement("div");y.innerHTML='<div data-form-element-component="picker"></div>',o=y.querySelector('[data-form-element-component="picker"]');var w=null;b((function(a,r){var i=function(){return a.isVisible(r)};a.addClickListener(n,(function(){i()?w(!1):(s=f(),k(),w(!0))})),w=function(l){l!==i()&&(l?(a.show(r,n,o,{showArrow:!1,align:"start",contentSpacing:2,preferedPositions:["bottom","top","left","right"],contentContainer:t.nextSibling,onBeforeShow:function(e){e.setAttribute("data-form-element-component","picker-tooltip")},onHide:function(){e.removeAttribute("data-form-element-data-opened","")}}),e.setAttribute("data-form-element-data-opened","")):a.hide(r))}}));var A=function(){for(var e=c(t.value),o=[],a=0;a<e.length;a++){var r=e[a].trim();o.push(d(r,i?["date"]:["monthDay","month"]))}n.innerText=o.join(", ")}}var S=function(){var e=t.getAttribute("min");e=null!==e?new Date(e):null;var n=t.getAttribute("max");return[e,n=null!==n?new Date(n):null]},k=function(){var n=""!==t.value,r='<div data-form-element-component="header">';l&&(r+='<div data-form-element-component="clear-button"></div>'),r+='<div data-form-element-component="month-button"></div>',i&&(r+='<div data-form-element-component="year-button"></div>'),r+='<div data-form-element-component="previous-button"></div>',r+='<div data-form-element-component="next-button"></div>',r+="</div>",r+='<div data-form-element-component="dates"></div>',o.innerHTML=r;var f=o.querySelector('[data-form-element-component="dates"]'),g=o.querySelector('[data-form-element-component="month-button"]'),y=o.querySelector('[data-form-element-component="year-button"]'),A=o.querySelector('[data-form-element-component="previous-button"]'),D=o.querySelector('[data-form-element-component="next-button"]');if(l)var E=o.querySelector('[data-form-element-component="clear-button"]');A.addEventListener("click",(function(){v(-1)})),D.addEventListener("click",(function(){v(1)})),l&&(E.addEventListener("click",(function(){""!==t.value&&(s=new Date,h(""),a&&w(!1))})),E.style.setProperty("opacity",n?"1":"0"),E.style.setProperty("pointer-events",n?"auto":"none"));var T=S(),x=T[0],F=T[1],M=s.getMonth(),q=function(e,t,n,a){b((function(t,r){t.addClickListener(e,(function(){if(t.isVisible(r))t.hide(r);else{var i=document.createElement("div"),l=a(i,(function(){t.hide(r)}));if(t.show(r,e,i,{showArrow:!1,align:"center",contentSpacing:2,preferedPositions:["bottom","top","left","right"],contentContainer:o,onBeforeShow:function(e){e.setAttribute("data-form-element-component",n)},onHide:function(){e.removeAttribute("data-form-element-data-opened","")}}),null!==l){l.setAttribute("data-form-element-data-selected","");var u=l.parentNode,m=l.getBoundingClientRect(),d=u.getBoundingClientRect();u.scrollTop=Math.round(Math.abs(m.y-d.y)-(d.height-m.height)/2)}e.setAttribute("data-form-element-data-opened","")}}))}),t)};g.innerText=d(s,["month"]),q(g,"m","months-tooltip",(function(e,t){e.setAttribute("data-form-element-component","months");for(var n=1;n<=12;n++){var o=document.createElement("div");o.setAttribute("data-form-element-component","month"),o.setAttribute("data-form-element-data-value",n),o.innerText=d("2000-"+n+"-1",["month"]),o.addEventListener("click",function(e){return function(){s.setMonth(e-1),t(),k()}}(n)),e.appendChild(o)}return e.querySelector('[data-form-element-data-value="'+(s.getMonth()+1)+'"]')})),null!==y&&(y.innerText=d(s,["year"]),q(y,"y","years-tooltip",(function(e,t){e.setAttribute("data-form-element-component","years");for(var n=(new Date).getFullYear(),o=n-200;o<=n+200;o++){var a=document.createElement("div");a.setAttribute("data-form-element-component","year"),a.setAttribute("data-form-element-data-value",o),a.innerText=o.toString(),a.addEventListener("click",function(e){return function(){s.setFullYear(e),t(),k()}}(o)),e.appendChild(a)}return e.querySelector('[data-form-element-data-value="'+s.getFullYear()+'"]')})));var C=new Date(s);if(C.setDate(1),i){var L=C.getDay();0===L&&(L=7),C.setDate(C.getDate()+1-L)}if(i)for(var Y=[d("2000-01-03",["weekDayShort"]),d("2000-01-04",["weekDayShort"]),d("2000-01-05",["weekDayShort"]),d("2000-01-06",["weekDayShort"]),d("2000-01-07",["weekDayShort"]),d("2000-01-08",["weekDayShort"]),d("2000-01-09",["weekDayShort"])],P=0;P<7;P++){(O=document.createElement("div")).setAttribute("data-form-element-component","day"),O.innerText=Y[P],f.appendChild(O)}var B=p(new Date,i),I=c(t.value),V=i?6:5;for(P=0;P<7*V;P++){var H=!1;(null!==x&&x.getTime()>C.getTime()||null!==F&&F.getTime()<C.getTime())&&(H=!0);var O,j=p(C,i);(O=document.createElement("div")).setAttribute("data-form-element-component","date"),O.setAttribute("data-form-element-data-value",j),O.setAttribute("data-form-element-data-day",P%7==5||P%7==6?"weekend":"weekday"),O.setAttribute("data-form-element-data-month",C.getMonth()===M?"current":"other"),-1!==I.indexOf(j)&&O.setAttribute("data-form-element-data-selected",""),j===B&&O.setAttribute("data-form-element-data-today",""),O.innerText=C.getDate().toString(),H?O.setAttribute("data-form-element-data-disabled",""):O.addEventListener("click",function(e){return function(){var n;if(m)if(u){var o=c(t.value);-1===o.indexOf(e)?o.push(e):(n=e,o=o.filter(e=>e!==n)),o.sort(),h(o.join(";",o)),k()}else h(e),a&&w(!1)}}(j)),f.appendChild(O),C.setDate(C.getDate()+1)}e.dispatchEvent(new Event("pickerUpdate",{bubbles:!1}))};r&&k(),e.showMonth=function(e,t){var n=new Date(s.getTime()),o=!1;void 0!==e&&(e=parseInt(e))>=1&&e<=12&&(e--,n.getMonth()!==e&&(n.setMonth(e),o=!0)),i&&void 0!==t&&(t=parseInt(t))>0&&n.getFullYear()!==t&&(n.setFullYear(t),o=!0);var a=S(),r=a[0],l=a[1];null!==r&&r.getTime()>n.getTime()?(n=r,o=!0):null!==l&&l.getTime()<n.getTime()&&(n=l,o=!0),o&&(s=n,k())},t.getFormElementContainer=function(){return e},e.getValue=function(){return t.value},e.setValue=function(e){t.value=e,a&&A()},e.setVisibility=function(t){e.setAttribute("data-form-element-visibility",t?"1":"0")}}}(elements[i]);
EOT;
