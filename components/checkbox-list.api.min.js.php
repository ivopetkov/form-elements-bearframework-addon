<?php

/*
 * Form elements addon for Bear Framework
 * https://github.com/ivopetkov/form-elements-bearframework-addon
 * Copyright (c) Ivo Petkov
 * Free to use under the MIT license.
 */

return <<<'EOT'
for(var elements=document.body.querySelectorAll("[data-form-element-type='checkbox-list']"),i=0;i<elements.length;i++)!function(e){if(void 0===e.dataFormElementAPISet){e.dataFormElementAPISet=!0;var t=e.querySelector('input[type="hidden"]'),n=e.querySelectorAll('input[type="checkbox"]');t.getFormElementContainer=function(){return e},e.getName=function(){return t.getAttribute("name")},e.getValue=function(){return t.value},e.setValue=function(e){try{var r=null!==e&&e.length>0?JSON.parse(e):[]}catch(e){throw new Error("Only empty string or JSON allowed!")}t.value=r.length>0?JSON.stringify(r):"";for(var o=[],l=0;l<n.length;l++){var i=(c=n[l]).getAttribute("value");c.checked=null!==i&&-1!==r.indexOf(i),c.checked&&o.push(i)}var u=r.filter((function(e){return o.indexOf(e)<0}));if(u.length>0){var a=u[0];for(l=0;l<n.length;l++){var c,d=(c=n[l]).parentNode.querySelector('[data-form-element-component="checkbox-list-option-textbox"]');null!==d&&(c.checked=!0,c.value=a,d.value=a)}}},e.focus=function(){var t=e.getFocusTarget();null!==t&&t.focus()},e.getFocusTarget=function(){var t=e.querySelector('input[type="checkbox"]');if(null!==t)return t;var n=e.querySelector('[data-form-element-component="checkbox-list-option-textbox"]');return null!==n?n:null},e.setVisibility=function(t){e.setAttribute("data-form-element-visibility",t?"1":"0")};for(var r=function(){for(var e=[],r=0;r<n.length;r++){var o=n[r];if(!0===o.checked){var l=o.value;null!==l&&""!==l&&e.push(l)}}t.value=e.length>0?JSON.stringify(e):""},o=0;o<n.length;o++)!function(e){e.addEventListener("change",(function(){r()}));var t=e.parentNode.querySelector('[data-form-element-component="checkbox-list-option-textbox"]');if(null!==t){var n=function(n){void 0!==n.keyCode&&9===n.keyCode||setTimeout((function(){var n=t.value;e.value=n,e.checked=!0,r()}),1)};t.addEventListener("change",n),t.addEventListener("keydown",n),t.addEventListener("keyup",n),t.addEventListener("cut",n),t.addEventListener("paste",n)}}(n[o])}}(elements[i]);
EOT;
